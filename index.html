<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Inventario</title>

  <!-- Librería para escaneo de códigos QR -->
  <script src="https://unpkg.com/html5-qrcode"></script>

  <style>
    /* Estilo general del cuerpo de la página */
    body {
      font-family: Arial, sans-serif;       /* Fuente clara y legible */
      text-align: center;                   /* Centra el contenido */
      padding: 20px;
      background-color: #ffffff;            /* Fondo blanco */
      color: #333333;                       /* Texto gris oscuro */
    }

    /* Encabezado con logo y título institucional */
    header {
      text-align: center;
      margin-bottom: 10px;
    }

    header img {
      width: 138px;                         /* Tamaño del logo */
      margin-bottom: 10px;
    }

    h2 {
      color: #006341;                       /* Verde institucional */
      margin-top: 0;
    }

    /* Línea divisoria debajo del encabezado */
    hr {
      border: 1px solid #006341;
      width: 80%;
      margin: 20px auto;
    }

    /* Botones grandes para uso táctil en móviles */
    button {
      padding: 16px 32px;
      font-size: 20px;
      margin: 12px;
      background-color: #006341;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      width: 80%;
      max-width: 400px;
    }

    button:hover {
      background-color: #004d33;            /* Efecto al pasar el cursor */
    }

    /* Área del lector QR (se muestra al escanear) */
    #reader {
      margin: auto;
      width: 100%;
      max-width: 600px;
      height: 400px;
      display: none;
      border: 2px solid #006341;
      border-radius: 8px;
    }

    /* Recuadro independiente para mostrar el folio escaneado */
    #folioBox {
      margin-top: 20px;
      padding: 16px;
      background-color: #e6f4ea;            /* Verde claro */
      border: 2px solid #006341;
      border-radius: 8px;
      font-size: 22px;
      font-weight: bold;
      color: #006341;
      width: 90%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
    }

    /* Área de resultados del escaneo */
    #result {
      margin-top: 20px;
      font-size: 18px;
      max-height: 900px;                    /* Altura extendida */
      overflow-x: auto;                     /* Scroll horizontal si hay muchas columnas */
      overflow-y: auto;                     /* Scroll vertical si hay muchos datos */
      padding: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      text-align: left;
      width: 95%;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      white-space: nowrap;                 /* Mantiene los datos en una sola línea */
    }

    /* Cada campo de información escaneada */
    .campo {
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .campo strong {
      color: #006341;
      font-size: 18px;
      min-width: 180px;
    }

    /* Pie de página institucional */
    footer {
      margin-top: 40px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>

  <!-- Encabezado institucional -->
  <header>
    <img src="https://lh3.googleusercontent.com/d/19w-yxgHtMzgLlQABl4n6k8Q_ua2Yqp2R=s220" alt="Logo institucional">
    <h2>Consulta de Inventario</h2>
  </header>

  <hr>

  <!-- Botones de acción para escanear y limpiar -->
  <div>
    <button onclick="iniciarEscaneo()">Nuevo escaneo</button>
    <button onclick="limpiarPantalla()">Limpiar pantalla</button>
  </div>

  <!-- Área del lector QR -->
  <div id="reader"></div>

  <!-- Recuadro para mostrar el folio escaneado -->
  <div id="folioBox"></div>

  <!-- Área para mostrar los resultados del activo -->
  <div id="result"></div>

  <!-- Pie de página institucional -->
  <footer>
    Inventario de Activo Fijo — Subdirección de Control de Personal - Jud. de Control de Personal.
  </footer>

  <!-- Script funcional para escaneo y consulta -->
  <script>
    let html5QrCode;

    // Inicia el escaneo de QR
    function iniciarEscaneo() {
      document.getElementById("reader").style.display = "block";
      html5QrCode = new Html5Qrcode("reader");

      html5QrCode.start(
        { facingMode: "environment" },       // Usa cámara trasera
        { fps: 10, qrbox: 400 },             // Configuración de escaneo
        onScanSuccess
      ).catch(err => {
        document.getElementById("result").innerText = "Error al iniciar cámara: " + err;
      });
    }

    // Se ejecuta cuando el escaneo es exitoso
    function onScanSuccess(decodedText) {
      html5QrCode.stop();                    // Detiene el escaneo
      document.getElementById("reader").style.display = "none";

      // Muestra el folio escaneado en su propio recuadro
      document.getElementById("folioBox").innerHTML = `<p>Folio escaneado: ${decodedText}</p>`;

      // Consulta los datos del activo
      consultarActivo(decodedText);
    }

    // Consulta los datos del activo en App Script
    async function consultarActivo(folio) {
  const response = await fetch(`https://script.google.com/macros/s/AKfycbw5vOGG4cdBjQ424X33UFIAbXY1cJmsVzcW2ETmwYl8ZrYVL06UoH61CnNqHAEHxeXc/exec?folio=${folio}`);
  const data = await response.json();


      if (data.error) {
        document.getElementById("result").innerHTML = `<p style="color:red;">${data.error}</p>`;
      } else {
        let html = "";
        for (const [clave, valor] of Object.entries(data)) {
          html += `<div class="campo"><strong>${clave}:</strong> ${valor}</div>`;
        }
        document.getElementById("result").innerHTML = html;
      }
    }

    // Limpia la pantalla y oculta el lector
    function limpiarPantalla() {
      document.getElementById("result").innerHTML = "";
      document.getElementById("folioBox").innerHTML = "";
      document.getElementById("reader").style.display = "none";
    }
  </script>
</body>
</html>